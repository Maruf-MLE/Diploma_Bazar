# মেসেজ বাকেট ট্রাবলশুটিং গাইড

## সমস্যা

বইচাপা বাজারের মেসেজিং সিস্টেমে ফাইল আপলোড (ছবি/ডকুমেন্ট) কাজ করছে না। এর কারণ হতে পারে:

1. `messages` বাকেট সুপাবেসে নেই বা সঠিকভাবে কনফিগার করা হয়নি
2. বাকেটে প্রয়োজনীয় ফোল্ডারগুলি নেই
3. বাকেটে পর্যাপ্ত পারমিশন পলিসি নেই
4. অন্যান্য কনফিগারেশন সমস্যা

## সমাধান

### ১. বাকেট স্ট্যাটাস চেক করুন

প্রথমে দেখুন যে `messages` বাকেট আছে কিনা এবং এটি সঠিকভাবে কনফিগার করা আছে কিনা:

```bash
npm run check:messages-bucket-no-auth
```

এই কমান্ড চালানোর পর, আপনি নিম্নলিখিত তথ্য দেখতে পাবেন:
- বাকেট আছে কিনা
- প্রয়োজনীয় ফোল্ডার আছে কিনা
- পলিসি সম্পর্কে নির্দেশনা

### ২. সুপাবেস ড্যাশবোর্ডে বাকেট তৈরি করুন

যদি বাকেট না থাকে, তাহলে সুপাবেস ড্যাশবোর্ডে গিয়ে এটি তৈরি করুন:

1. [সুপাবেস ড্যাশবোর্ডে](https://app.supabase.com) লগইন করুন
2. আপনার প্রজেক্ট সিলেক্ট করুন
3. বাম সাইডবারে **Storage** এ ক্লিক করুন
4. **New Bucket** বাটনে ক্লিক করুন
5. বাকেটের নাম `messages` দিন
6. **Public bucket** চেকবক্স **আনচেক** করুন (এটি খুবই গুরুত্বপূর্ণ!)
7. **Create bucket** বাটনে ক্লিক করুন

### ৩. প্রয়োজনীয় ফোল্ডার তৈরি করুন

বাকেট তৈরি করার পর, দুটি প্রয়োজনীয় ফোল্ডার তৈরি করুন:

1. `messages` বাকেটে ক্লিক করুন
2. **Create folder** বাটনে ক্লিক করুন
3. ফোল্ডারের নাম `message_images` দিন
4. **Create folder** বাটনে ক্লিক করুন
5. আবার **Create folder** বাটনে ক্লিক করুন
6. ফোল্ডারের নাম `message_documents` দিন
7. **Create folder** বাটনে ক্লিক করুন

### ৪. পলিসি তৈরি করুন

বাকেট এবং ফোল্ডার তৈরি করার পর, পলিসি তৈরি করুন:

1. `messages` বাকেটে ক্লিক করুন
2. উপরের ন্যাভিগেশন বারে **Policies** ট্যাবে ক্লিক করুন
3. **New Policy** বাটনে ক্লিক করুন
4. নিম্নলিখিত পলিসিগুলি একে একে তৈরি করুন:

#### পলিসি ১: আপলোড পলিসি

1. **Policy name**: `Allow authenticated users to upload files`
2. **Allowed operations**: `INSERT` চেকবক্স সিলেক্ট করুন
3. **Target roles**: `authenticated` সিলেক্ট করুন
4. **Using expression**: `bucket_id = 'messages'` লিখুন
5. **Save policy** বাটনে ক্লিক করুন

#### পলিসি ২: ডাউনলোড পলিসি

1. **Policy name**: `Allow authenticated users to view files`
2. **Allowed operations**: `SELECT` চেকবক্স সিলেক্ট করুন
3. **Target roles**: `authenticated` সিলেক্ট করুন
4. **Using expression**: `bucket_id = 'messages'` লিখুন
5. **Save policy** বাটনে ক্লিক করুন

#### পলিসি ৩: আপডেট পলিসি

1. **Policy name**: `Allow authenticated users to update their files`
2. **Allowed operations**: `UPDATE` চেকবক্স সিলেক্ট করুন
3. **Target roles**: `authenticated` সিলেক্ট করুন
4. **Using expression**: `bucket_id = 'messages'` লিখুন
5. **Save policy** বাটনে ক্লিক করুন

#### পলিসি ৪: ডিলিট পলিসি

1. **Policy name**: `Allow authenticated users to delete their files`
2. **Allowed operations**: `DELETE` চেকবক্স সিলেক্ট করুন
3. **Target roles**: `authenticated` সিলেক্ট করুন
4. **Using expression**: `bucket_id = 'messages'` লিখুন
5. **Save policy** বাটনে ক্লিক করুন

### ৫. আবার চেক করুন

সব সেটআপ করার পর, আবার চেক করুন:

```bash
npm run check:messages-bucket-no-auth
```

এবার সব ঠিক থাকা উচিত।

## সাধারণ সমস্যা এবং সমাধান

### সমস্যা: "messages bucket does not exist"

**সমাধান**: উপরের পদক্ষেপ ২ অনুসরণ করে বাকেট তৈরি করুন।

### সমস্যা: "message_images/message_documents folder does not exist"

**সমাধান**: উপরের পদক্ষেপ ৩ অনুসরণ করে ফোল্ডার তৈরি করুন।

### সমস্যা: "Permission denied" বা "Unauthorized"

**সমাধান**: 
1. উপরের পদক্ষেপ ৪ অনুসরণ করে পলিসি তৈরি করুন।
2. নিশ্চিত করুন যে আপনি অ্যাপে লগইন আছেন।

### সমস্যা: "Failed to fetch" এরর

**সমাধান**:
1. ব্রাউজার কনসোলে চেক করুন কোন নেটওয়ার্ক এরর আছে কিনা।
2. সুপাবেস URL এবং API কী সঠিক আছে কিনা চেক করুন।
3. আপনার ইন্টারনেট সংযোগ চেক করুন।

### সমস্যা: "TypeError: Failed to fetch"

এই এররটি সাধারণত নেটওয়ার্ক সংযোগ সমস্যা বা CORS সমস্যার কারণে হয়।

**সমাধান**:
1. আপনার ইন্টারনেট সংযোগ চেক করুন।
2. সুপাবেস প্রজেক্টের সেটিংসে গিয়ে API URL এবং সিকিউরিটি সেটিংস চেক করুন।
3. ব্রাউজার কুকি এবং ক্যাশে পরিষ্কার করুন।
4. সুপাবেস ড্যাশবোর্ডে API সেটিংসে CORS সেটিংস চেক করুন।

## অতিরিক্ত সাহায্য

যদি আপনি এখনও সমস্যার সম্মুখীন হন, নিম্নলিখিত তথ্য সহ সাহায্য চান:

1. ব্রাউজার কনসোলের এরর মেসেজ
2. `npm run check:messages-bucket-no-auth` কমান্ডের আউটপুট
3. সুপাবেস ড্যাশবোর্ডের স্ক্রিনশট 