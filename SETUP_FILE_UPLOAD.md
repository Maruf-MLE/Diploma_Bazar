# বার্তায় ফাইল পাঠানোর সেটআপ নির্দেশিকা

বার্তায় ছবি এবং ডকুমেন্ট পাঠানোর জন্য Supabase Storage ব্যবহার করা হয়। নিচের নির্দেশাবলী অনুসরণ করে আপনি এই ফিচারটি সক্রিয় করতে পারবেন।

## ১. ডাটাবেস কলাম সেটআপ

প্রথমে নিশ্চিত করুন যে `messages` টেবিলে ফাইল সংরক্ষণের জন্য প্রয়োজনীয় কলামগুলো আছে:

```bash
node run_file_attachments_migration.js
```

এই স্ক্রিপ্টটি চালানোর মাধ্যমে নিম্নলিখিত কলামগুলো যোগ করা হবে:
- `file_url` - ফাইলের URL সংরক্ষণের জন্য
- `file_type` - ফাইলের প্রকার (image/document) সংরক্ষণের জন্য
- `file_name` - আসল ফাইল নাম সংরক্ষণের জন্য

## ২. স্টোরেজ বাকেট সেটআপ

Supabase ড্যাশবোর্ডে একটি `messages` নামের স্টোরেজ বাকেট তৈরি করতে হবে:

1. **বাকেট তৈরি করুন**:
   - Supabase ড্যাশবোর্ডে লগইন করুন (https://app.supabase.com)
   - আপনার প্রজেক্টে যান
   - বাম দিকের মেনু থেকে "Storage" এ ক্লিক করুন
   - "New Bucket" বাটনে ক্লিক করুন
   - নাম দিন: `messages` (ঠিক এই নামটিই ব্যবহার করতে হবে)
   - "Public bucket" চেকবক্স অনসিলেক্ট রাখুন
   - "Create bucket" বাটনে ক্লিক করুন

2. **বাকেট পলিসি সেট করুন**:
   - তৈরি করা `messages` বাকেটে ক্লিক করুন
   - "Policies" ট্যাবে ক্লিক করুন
   - "Add Policy" বাটনে ক্লিক করুন
   
   **আপলোড পলিসি**:
   - "Policy name": `allow_authenticated_uploads`
   - "For templates": `Custom`
   - "Target roles": `authenticated`
   - "Operation": `INSERT`
   - "SQL Editor" এ লিখুন: `true`
   - "Save policy" বাটনে ক্লিক করুন

   **ডাউনলোড পলিসি**:
   - "Add Policy" বাটনে আবার ক্লিক করুন
   - "Policy name": `allow_authenticated_downloads`
   - "For templates": `Custom`
   - "Target roles": `authenticated`
   - "Operation": `SELECT`
   - "SQL Editor" এ লিখুন: `true`
   - "Save policy" বাটনে ক্লিক করুন

## ৩. কনফিগারেশন টেস্ট করুন

স্টোরেজ সেটআপ ঠিকভাবে হয়েছে কিনা তা যাচাই করতে:

```bash
node check_messages_bucket.js
```

এই স্ক্রিপ্টটি চালানোর ফলে আপনি নিম্নলিখিত তথ্যগুলো জানতে পারবেন:
- বাকেট সঠিকভাবে সেট আপ হয়েছে কিনা
- ফাইল আপলোড করা যাবে কিনা
- ফাইল ডাউনলোড করা যাবে কিনা

## ৪. ফাইল আপলোড ফিচার ব্যবহার

সেটআপ সম্পূর্ণ হলে, বার্তা পাঠানোর পেজে নিচের ফিচারগুলো ব্যবহার করতে পারবেন:

- **ছবি পাঠানো**: ছবি আইকনে ক্লিক করে ইমেজ ফাইল সিলেক্ট করুন
- **ডকুমেন্ট পাঠানো**: পেপারক্লিপ আইকনে ক্লিক করে ডকুমেন্ট ফাইল সিলেক্ট করুন

## ৫. সমস্যা সমাধান

যদি ফাইল আপলোড/ডাউনলোড করতে সমস্যা হয়, নিম্নলিখিত বিষয়গুলো চেক করুন:

1. **বাকেট নাম**: বাকেটের নাম ঠিক `messages` হতে হবে
2. **পলিসি সেটিংস**: বাকেট পলিসিগুলো সঠিকভাবে সেট আপ করা হয়েছে কিনা
3. **Authentication**: ব্যবহারকারী লগইন করা আছে কিনা (ফাইল আপলোড/ডাউনলোড করতে লগইন করা থাকতে হবে)
4. **ব্রাউজার কনসোল**: ব্রাউজারের কনসোলে কোনো এরর মেসেজ আছে কিনা

যদি "Error sending file" দেখায়, তাহলে দুটি সম্ভাব্য কারণ থাকতে পারে:
1. Supabase Storage বাকেট সঠিকভাবে সেটআপ করা হয়নি
2. ব্যবহারকারীর অনুমতি সঠিকভাবে সেট করা হয়নি 