# বই-চাপা-বাজার ভেরিফিকেশন সিস্টেম

## সেটআপ নির্দেশনা

এই মাইগ্রেশন ফাইলগুলি Supabase ড্যাশবোর্ডের SQL এডিটরে রান করতে হবে।

1. প্রথমে `create_verification_table.sql` ফাইলটি রান করুন
2. তারপর `create_verification_view.sql` ফাইলটি রান করুন

## OCR ফিচার

ভেরিফিকেশন পেইজে Tesseract.js ব্যবহার করে আপলোড করা ছবি থেকে টেক্সট সনাক্তকরণ করা হয়। এটি নিম্নলিখিত তথ্য সনাক্ত করতে পারে:

- নাম
- আইডি/রোল নম্বর
- ডিপার্টমেন্ট
- ইনস্টিটিউট
- সেশন

সনাক্তকৃত তথ্য `verifications` টেবিলের `extracted_info` JSONB ফিল্ডে সংরক্ষণ করা হয়।

## অ্যাডমিন জন্য ব্যবহার নির্দেশিকা

### ভেরিফিকেশন রিকোয়েস্ট দেখার জন্য

Supabase ড্যাশবোর্ডের টেবিল ভিউতে গিয়ে `verification_details` ভিউ থেকে সমস্ত পেন্ডিং রিকোয়েস্ট দেখুন। নিম্নলিখিত SQL কোয়েরি ব্যবহার করতে পারেন:

```sql
SELECT * FROM verification_details
WHERE status = 'pending'
ORDER BY created_at DESC;
```

### ভেরিফিকেশন অ্যাপ্রুভ করতে

```sql
UPDATE verifications
SET 
  status = 'approved',
  updated_at = NOW()
WHERE id = 'verification_id_here';
```

### ভেরিফিকেশন রিজেক্ট করতে

```sql
UPDATE verifications
SET 
  status = 'rejected',
  feedback = 'রিজেক্ট করার কারণ এখানে লিখুন',
  updated_at = NOW()
WHERE id = 'verification_id_here';
```

### সনাক্তকৃত তথ্য দেখতে

```sql
SELECT user_id, extracted_info 
FROM verifications 
WHERE extracted_info IS NOT NULL AND extracted_info != '{}'::jsonb;
```

### ভেরিফিকেশন ডকুমেন্টগুলো দেখতে

স্টোরেজ সেকশনে `verification_documents` বাকেটে যান। এখানে সকল আপলোড করা ডকুমেন্টগুলো পাবেন।

### ইউজার প্রোফাইলে ভেরিফাইড ব্যাজ দেখানো

যে সকল ইউজারদের `verifications.status = 'approved'` আছে, সেই ইউজারদের প্রোফাইলে একটি ভেরিফাইড ব্যাজ দেখানো হবে।

## সিকিউরিটি কনসিডারেশন

- RLS (Row Level Security) পলিসিগুলো ইমপ্লিমেন্ট করা হয়েছে
- শুধুমাত্র নিজের ভেরিফিকেশন রেকর্ড দেখা/আপডেট করতে পারবে ইউজার
- এডমিন রোল ছাড়া কেউ অন্য ইউজারের ভেরিফিকেশন স্টেটাস চেঞ্জ করতে পারবে না
- ভেরিফিকেশন ডকুমেন্টগুলো পাবলিক অ্যাক্সেস করা যাবে না 

## ডাটাবেস স্ট্রাকচার

### verification_data টেবিল

এই টেবিলে ব্যবহারকারীদের ভেরিফিকেশন ডেটা সংরক্ষণ করা হয়:

- `id`: ইউনিক আইডি (UUID)
- `user_id`: ব্যবহারকারীর আইডি (auth.users টেবিলের সাথে সম্পর্কিত)
- `name`: ছবি থেকে সনাক্তকৃত নাম (Name of Examinee)
- `roll_no`: ছবি থেকে সনাক্তকৃত রোল নম্বর
- `reg_no`: ছবি থেকে সনাক্তকৃত রেজিস্ট্রেশন নম্বর
- `document_url`: আপলোড করা ডকুমেন্টের URL
- `created_at`: রেকর্ড তৈরির সময়
- `updated_at`: রেকর্ড আপডেটের সময়

### verification_view ভিউ

এই ভিউ ব্যবহারকারীদের ভেরিফিকেশন ডেটা এবং তাদের প্রোফাইল তথ্য একত্রিত করে:

- `id`: ভেরিফিকেশন রেকর্ডের আইডি
- `user_id`: ব্যবহারকারীর আইডি
- `email`: ব্যবহারকারীর ইমেইল
- `full_name`: ব্যবহারকারীর পূর্ণ নাম (profiles টেবিল থেকে)
- `extracted_name`: ডকুমেন্ট থেকে সনাক্তকৃত নাম
- `roll_no`: সনাক্তকৃত রোল নম্বর
- `reg_no`: সনাক্তকৃত রেজিস্ট্রেশন নম্বর
- `document_url`: আপলোড করা ডকুমেন্টের URL
- `created_at`: রেকর্ড তৈরির সময়
- `updated_at`: রেকর্ড আপডেটের সময়

## স্টোরেজ বাকেট

- `verification_documents`: এই বাকেটে ব্যবহারকারীদের আপলোড করা ডকুমেন্ট সংরক্ষণ করা হয়

## সিকিউরিটি পলিসি

- ব্যবহারকারীরা শুধুমাত্র তাদের নিজের ভেরিফিকেশন ডেটা দেখতে, সম্পাদনা করতে এবং আপলোড করতে পারবেন
- ব্যবহারকারীরা শুধুমাত্র তাদের নিজের ডকুমেন্ট দেখতে পারবেন 