# বই-চাপা-বাজার ভেরিফিকেশন সিস্টেম

## ভূমিকা

বই-চাপা-বাজার প্ল্যাটফর্মে নিরাপদ লেনদেন নিশ্চিত করতে ভেরিফিকেশন সিস্টেম যোগ করা হয়েছে। এই সিস্টেমের মাধ্যমে শুধুমাত্র ভেরিফাইড ব্যবহারকারীরাই বই বিক্রি করতে এবং অন্য ব্যবহারকারীদের সাথে মেসেজ আদান-প্রদান করতে পারবেন।

## ফিচার

1. **ভেরিফিকেশন চেক**:
   - ভেরিফাইড ব্যবহারকারী ছাড়া কেউ বই বিক্রি করতে পারবেন না
   - ভেরিফাইড ব্যবহারকারী ছাড়া কেউ মেসেজ পাঠাতে পারবেন না
   - ভেরিফাইড না হলে সিস্টেম স্বয়ংক্রিয়ভাবে ভেরিফিকেশন পেজে রিডাইরেক্ট করবে

2. **ভেরিফিকেশন প্রসেস**:
   - ব্যবহারকারীকে তার স্টুডেন্ট আইডি কার্ড/অফিসিয়াল ডকুমেন্ট আপলোড করতে হবে
   - সিস্টেম OCR দিয়ে ডকুমেন্ট থেকে তথ্য সনাক্ত করবে
   - ব্যবহারকারীকে সেলফি আপলোড করতে হবে (ফেস ভেরিফিকেশন)
   - এডমিন ভেরিফিকেশন রিকোয়েস্ট রিভিউ করে অনুমোদন/প্রত্যাখ্যান করবেন

## ইনস্টলেশন এবং সেটআপ

1. **ভেরিফিকেশন টেবিল আপডেট**:
   ```bash
   npm run update:verification
   ```

2. **ভেরিফিকেশন সিস্টেম কনফিগারেশন**:
   - AuthContext এ ভেরিফিকেশন স্টেট যোগ করা হয়েছে
   - ভেরিফিকেশন চেক ফাংশন আপডেট করা হয়েছে
   - বই বিক্রি এবং মেসেজিং পেজে ভেরিফিকেশন চেক যোগ করা হয়েছে

## ব্যবহার নির্দেশিকা

### ব্যবহারকারীদের জন্য

1. **ভেরিফিকেশন প্রসেস**:
   - লগইন করুন
   - প্রোফাইল পেজে যান এবং "ভেরিফিকেশন" বাটনে ক্লিক করুন
   - আপনার স্টুডেন্ট আইডি কার্ড/অফিসিয়াল ডকুমেন্ট আপলোড করুন
   - সেলফি আপলোড করুন
   - অনুমোদনের জন্য অপেক্ষা করুন

2. **ভেরিফিকেশন স্টেটাস চেক**:
   - প্রোফাইল পেজে "ভেরিফিকেশন স্টেটাস" দেখুন
   - ভেরিফাইড হলে "ভেরিফাইড" ব্যাজ দেখাবে

### এডমিনদের জন্য

1. **ভেরিফিকেশন রিকোয়েস্ট রিভিউ**:
   - এডমিন ড্যাশবোর্ডে যান
   - "ভেরিফিকেশন রিকোয়েস্ট" সেকশনে যান
   - রিকোয়েস্ট দেখুন এবং ডকুমেন্ট/সেলফি ভেরিফাই করুন
   - অনুমোদন/প্রত্যাখ্যান করুন

2. **ভেরিফিকেশন স্টেটাস আপডেট**:
   - ভেরিফিকেশন অনুমোদন করলে ব্যবহারকারীকে নোটিফিকেশন যাবে
   - প্রত্যাখ্যান করলে ব্যবহারকারীকে কারণসহ নোটিফিকেশন যাবে

## ডাটাবেস স্ট্রাকচার

### verification_data টেবিল

```sql
CREATE TABLE IF NOT EXISTS public.verification_data (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT,
  roll_no TEXT,
  reg_no TEXT,
  document_url TEXT,
  is_verified BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### face_verification টেবিল

```sql
CREATE TABLE IF NOT EXISTS public.face_verification (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  photo_url TEXT,
  status TEXT DEFAULT 'pending', -- 'pending', 'approved', 'rejected'
  is_verified BOOLEAN DEFAULT false,
  feedback TEXT, -- Admin feedback if rejected
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## ট্রাবলশুটিং

1. **ভেরিফিকেশন স্টেটাস আপডেট হচ্ছে না**:
   - AuthContext এ `checkVerification()` ফাংশন কল করুন
   - ডাটাবেসে ভেরিফিকেশন রেকর্ড চেক করুন

2. **ভেরিফিকেশন রিডাইরেকশন লুপ**:
   - কনসোল লগ চেক করুন
   - ভেরিফিকেশন স্টেটাস ম্যানুয়ালি আপডেট করুন

## সিকিউরিটি কনসিডারেশন

- RLS (Row Level Security) পলিসিগুলো ইমপ্লিমেন্ট করা হয়েছে
- শুধুমাত্র নিজের ভেরিফিকেশন রেকর্ড দেখা/আপডেট করতে পারবে ইউজার
- এডমিন রোল ছাড়া কেউ অন্য ইউজারের ভেরিফিকেশন স্টেটাস চেঞ্জ করতে পারবে না
- ভেরিফিকেশন ডকুমেন্টগুলো পাবলিক অ্যাক্সেস করা যাবে না 